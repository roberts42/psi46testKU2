; DB reset test
;
;--- 480 samples read ------------------
;Header:7F8 #pixel:79
;[ 6  0 221] 03.424  [ 6  1 215] 03.422  [ 6  2 206] 03.420  [ 6  3 230] 03.414
;[ 6  4 224] 03.412  [ 6  5 214] 03.410  [ 6  6 220] 03.404  [ 6  7 212] 03.402
;[ 6  8 204] 03.400  [ 6  9 228] 03.354  [ 6 10 221] 03.352  [ 6 11 214] 03.350
;[ 6 12 218] 03.344  [ 6 13 210] 03.342  [ 6 14 204] 03.340  [ 6 15 230] 03.334
;[ 6 16 220] 03.332  [ 6 17 215] 03.330  [ 6 18 218] 03.324  [ 6 19 211] 03.322
;[ 6 20 202] 03.320  [ 6 21 227] 03.314  [ 6 22 218] 03.312  [ 6 23 214] 03.310
;[ 6 24 215] 03.304  [ 6 25 206] 03.302  [ 6 26 201] 03.300  [ 6 27 227] 03.254
;[ 6 28 218] 03.252  [ 6 29 212] 03.250  [ 6 30 216] 03.244  [ 6 31 208] 03.242
;[ 6 32 202] 03.240  [ 6 33 227] 03.234  [ 6 34 218] 03.232  [ 6 35 214] 03.230
;[ 6 36 216] 03.224  [ 6 37 208] 03.222  [ 6 38 202] 03.220  [ 6 39 226] 03.214
;[ 6 40 218] 03.212  [ 6 41 212] 03.210  [ 6 42 216] 03.204  [ 6 43 205] 03.202
;[ 6 44 200] 03.200  [ 6 45 226] 03.154  [ 6 46 218] 03.152  [ 6 47 214] 03.150
;[ 6 48 215] 03.144  [ 6 49 210] 03.142  [ 6 50 200] 03.140  [ 6 51 226] 03.134
;[ 6 52 218] 03.132  [ 6 53 211] 03.130  [ 6 54 216] 03.124  [ 6 55 208] 03.122
;[ 6 56 200] 03.120  [ 6 57 225] 03.114  [ 6 58 218] 03.112  [ 6 59 210] 03.110
;[ 6 60 214] 03.104  [ 6 61 204] 03.102  [ 6 62 200] 03.100  [ 6 63 224] 03.054
;[ 6 64 217] 03.052  [ 6 65 211] 03.050  [ 6 66 215] 03.044  [ 6 67 206] 03.042
;[ 6 68 200] 03.040  [ 6 69 226] 03.034  [ 6 70 217] 03.032  [ 6 71 210] 03.030
;[ 6 72 214] 03.024  [ 6 73 204] 03.022  [ 6 74 200] 03.020  [ 6 75 222] 03.014
;[ 6 76 216] 03.012  [ 6 77 212] 03.010  [ 6 78 217] 03.004
;--- 6 samples read ------------------
;Header:7F8 #pixel:0
;--- 480 samples read ------------------
;Header:7F8 #pixel:79
;[ 6  0 220] 03.424  [ 6  1 211] 03.422  [ 6  2 208] 03.420  [ 6  3 230] 03.414
;[ 6  4 224] 03.412  [ 6  5 216] 03.410  [ 6  6 220] 03.404  [ 6  7 212] 03.402
;[ 6  8 204] 03.400  [ 6  9 230] 03.354  [ 6 10 221] 03.352  [ 6 11 214] 03.350
;[ 6 12 218] 03.344  [ 6 13 211] 03.342  [ 6 14 204] 03.340  [ 6 15 230] 03.334
;[ 6 16 220] 03.332  [ 6 17 215] 03.330  [ 6 18 218] 03.324  [ 6 19 210] 03.322
;[ 6 20 202] 03.320  [ 6 21 227] 03.314  [ 6 22 219] 03.312  [ 6 23 214] 03.310
;[ 6 24 215] 03.304  [ 6 25 208] 03.302  [ 6 26 202] 03.300  [ 6 27 227] 03.254
;[ 6 28 218] 03.252  [ 6 29 214] 03.250  [ 6 30 216] 03.244  [ 6 31 207] 03.242
;[ 6 32 202] 03.240  [ 6 33 228] 03.234  [ 6 34 219] 03.232  [ 6 35 214] 03.230
;[ 6 36 216] 03.224  [ 6 37 208] 03.222  [ 6 38 202] 03.220  [ 6 39 225] 03.214
;[ 6 40 217] 03.212  [ 6 41 211] 03.210  [ 6 42 216] 03.204  [ 6 43 204] 03.202
;[ 6 44 200] 03.200  [ 6 45 227] 03.154  [ 6 46 217] 03.152  [ 6 47 213] 03.150
;[ 6 48 216] 03.144  [ 6 49 209] 03.142  [ 6 50 199] 03.140  [ 6 51 227] 03.134
;[ 6 52 217] 03.132  [ 6 53 211] 03.130  [ 6 54 216] 03.124  [ 6 55 206] 03.122
;[ 6 56 200] 03.120  [ 6 57 225] 03.114  [ 6 58 218] 03.112  [ 6 59 210] 03.110
;[ 6 60 213] 03.104  [ 6 61 205] 03.102  [ 6 62 200] 03.100  [ 6 63 224] 03.054
;[ 6 64 218] 03.052  [ 6 65 211] 03.050  [ 6 66 215] 03.044  [ 6 67 206] 03.042
;[ 6 68 199] 03.040  [ 6 69 227] 03.034  [ 6 70 216] 03.032  [ 6 71 210] 03.030
;[ 6 72 216] 03.024  [ 6 73 208] 03.022  [ 6 74 201] 03.020  [ 6 75 222] 03.014
;[ 6 76 215] 03.012  [ 6 77 211] 03.010  [ 6 78 216] 03.004
;--- 6 samples read ------------------
;Header:7F8 #pixel:0

init
pgdis

;-- start up --------------------------
fsel   0      40 MHz (T = 25ns)
clk   24 ns
sda   19 ns
ctr   11 ns
tin   11 ns
flush
udelay 10

vd 2500 mV
va 1500 mV
pon
chipid 0
select 0
mdelay 500

mask         ;mask all pixels and dcols
flush

;--- set ROC dacs ---------------------
dac   1   8  ;Vdig
vana     80  ;Vana
dac   3  20  ;Vsf
dac   4  12  ;Vcomp

dac   7  60  ;VwllPr
dac   9  60  ;VwllPr
dac  10 255  ;VhldDel
dac  11 100  ;Vtrim
vthr     50  ;VthrComp

dac  13  30  ;VIBias_Bus
dac  14   6  ;Vbias_sf
dac  22  99  ;VIColOr

dac  15  80  ;VoffsetOp
dac  17 140  ;VoffsetRO
dac  18 115  ;VIon

dac  19 100  ;Vcomp_ADC 100
dac  20 150  ;VIref_ADC

vcal    180  ;Vcal
dac  26  39  ;CalDel

dac  $fd  4  ;CtrlReg  CAL high range

wbc     210  ;WBC

pgset 0 b1000 0 ;update WBC
pgsingle
udelay 100

;--- setup testboard DAQ --------------
set 26 0
set 43 2
set 41 b0100001  ;select ADC2 = SDATA
droc

;--- enable pixel ---------------------
cole :
pixe : :  0

;--- reset ROC ------------------------
pgset 0 b1000  0
pgloop 10000
udelay 1000
pgdis
flush

;--- setup pattern --------------------

pgset 0 b1000  22  ;RES on
pgset 1 b0100 216  ;CAL (=WBC+6)
pgset 2 b0010  16  ;TRG
pgset 3 b0001   0  ;TOK

; 79 pixel -> no reset
cald
cal 6 0:78
dtrig
pgsingle
udelay 100
dreadd 4

; 80 pixel -> reset
cald
cal 6 0:79
dtrig
pgsingle
udelay 100
dreadd 4


;--- single not verified hit
cald
cal 6 0
pgset 0 b1000 20   ;RES
pgset 1 b0100  0   ;CAL
pgsingle
udelay 100

;--- 79 pixel -> no reset
cald
cal 6 0:78

pgset 0 b0100 216  ;CAL (=WBC+6)
pgset 1 b0010  16  ;TRG
pgset 2 b0001   0  ;TOK

dtrig
pgsingle
udelay 100
dreadd 4

;--- single not verified hit
cald
cal 6 0
pgset 0 b1000 20   ;RES
pgset 1 b0100  0   ;CAL
pgsingle
udelay 100

;--- 80 pixel -> reset
cald
cal 6 0:79

pgset 0 b0100 216  ;CAL (=WBC+6)
pgset 1 b0010  16  ;TRG
pgset 2 b0001   0  ;TOK

dtrig
pgsingle
udelay 100
dreadd 4


flush
